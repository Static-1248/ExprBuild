# 设计笔记迁移说明
> 我们需要重写过时的design-note-1文档，以适应新的设计方案。

## 设计范式变更
1. **表达式构建方式**  
   - 旧方案：链式方法调用（`a['+'](b)`）
   - 新方案：模板字符串DSL（``expr`${a}^2 + ${b}^2` ``）
   - 影响范围：所有运算符实现、类型推断逻辑

2. **类型系统调整**  
   - 新增模板字符串解析阶段
   - 强化TS类型体操实现：
     ```ts
     type Expr<Deps extends string = never> = {
       _deps: Deps;
       toLatex(): string;
     }
     ```

## 保留的核心内容
1. **数学运算符分类体系**  
   - 基础运算（加减乘除）
   - 统计函数（mean/stdev）
   - 几何运算（point/distance）

2. **特殊语法实现方案**  
   - 列表推导式（`[x^2 for x in L]`）
   - 分段函数（`If(cond)(expr1)(expr2)`）

3. **表达式元数据追踪**  
   - 依赖关系图谱构建
   - 循环依赖检测机制

## 待处理事项
|| 旧设计条目 | 新设计状态 |
|---|---|---|
| ◻ | 链式调用运算符实现 | 已废弃 |
| ✔ | 统计函数参数校验 | 已迁移 |
| ◻ | 颜色系统类型定义 | 需适配DSL |

## 迁移策略
1. **渐进式替换**  
   保留旧设计文档中的数学功能矩阵表（第89-203行），逐步替换实现方式

2. **类型测试保障**  
   添加TS类型测试用例：
   ```ts
   type Test = typeof expr<'a'|'b'>`${a}^2 + ${b}^2`;
   // 应推断出 { _deps: 'a'|'b' }
   ```

3. **文档同步机制**  
   建立DSL语法速查表（见`docs/dsl-cheatsheet.md`）

规划一下新文档的结构；它可以不必再是“设计笔记”了，看看写成什么形式最好。将新文档的大概结构加载migration note里的后边。

同时补充一下：ExprBuild是面向Desmos的，设计导向是以代码的形式在用户和Desmos之间搭建桥梁。